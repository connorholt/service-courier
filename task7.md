## üè† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∫—É—Ä—Å–∞ "–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –Ω–∞ GO"

### –ó–∞–¥–∞–Ω–∏–µ 7. Gateway –∫ `service-order` –∏ —Ç–∏–∫–µ—Ä –Ω–∞ 5 —Å–µ–∫—É–Ω–¥

–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ —Å—Ç–æ–∏—Ç –Ω–∞ –º–µ—Å—Ç–µ. –ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–∏—Å–æ–º –¥—Ä—É–≥–æ–π –∫–æ–º–∞–Ω–¥—ã.
–í–∞—à –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å **–∑–∞–±–∏—Ä–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ `service-order`** –∏ **–Ω–∞–∑–Ω–∞—á–∞—Ç—å –Ω–∞ –Ω–∏—Ö –∫—É—Ä—å–µ—Ä–æ–≤**. 
–î–ª—è —ç—Ç–æ–≥–æ –¥–æ–±–∞–≤—å—Ç–µ gateway-—Å–ª–æ–π –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –æ–ø—Ä–æ—Å –ø–æ —Ç–∏–∫–µ—Ä—É –∫–∞–∂–¥—ã–µ **5 —Å–µ–∫—É–Ω–¥**.

–î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ–¥–Ω—è—Ç—å –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å, —É –Ω–∞—Å –Ω–∞–ø–∏—Å–∞–Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è.
–†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –≤—Å–µ –±—É–¥–µ–º –ª–æ–∫–∞–ª—å–Ω–æ, –≤–µ–¥—å –æ—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å —Å–µ–π—á–∞—Å –Ω–∞—É—á–∏—Ç—å—Å—è –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –∞ –Ω–∞—É—á–∏—Ç—å—Å—è –¥–µ–ø–ª–æ–∏—Ç—å –≤ k8s —Ç—ã –µ—â–µ —Ç–æ—á–Ω–æ —É—Å–ø–µ–µ—à—å.

---

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–°–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞—Ç—å gateway –∫ `service-order`**
    - –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–∫–µ—Ç `internal/gateway/order` –∏ –¥–æ–±–∞–≤—å –Ω—É–∂–Ω—ã–π http –∑–∞–ø—Ä–æ—Å:
```curl --location 'http://localhost:8080/public/api/v1/orders?from=2025-09-01T12%3A04%3A05.696Z' --header 'Accept: application/json'```
    - –†–µ–∞–ª–∏–∑—É–π—Ç–µ HTTP-–∫–ª–∏–µ–Ω—Ç c –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (`BASE_URL`, `TIMEOUT`, `RETRY_COUNT`), –±–µ—Ä—É—â–∏–º–∏—Å—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞/ENV.
    - –ü–æ–¥–¥–µ—Ä–∂–∏—Ç–µ **–ø–∞–≥–∏–Ω–∞—Ü–∏—é** –∏ **–∫—É—Ä—Å–æ—Ä** –ø–æ id –∏–ª–∏ created_at.

2. **–î–æ–±–∞–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä —Å —Ç–∏–∫–µ—Ä–æ–º (5 —Å–µ–∫)**
    - –ü–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–∞ –∫–∞–∂–¥—ã–π —Ç–∏–∫:
        1. –°—á–∏—Ç–∞—Ç—å —Ç–µ–∫—É—â–∏–π `cursor` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `created_at` —Ä–∞–≤–Ω—ã–π now - 5s).
        2. –í—ã–∑–≤–∞—Ç—å –º–µ—Ç–æ–¥ gateway.
        3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –∫—É—Ä—å–µ—Ä–∞ —á–µ—Ä–µ–∑ –≤–∞—à `usecase`.
    - –í–æ—Ä–∫–µ—Ä –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–≤–µ—Ä—à–∞—Ç—å—Å—è –ø–æ `context` (graceful shutdown).

---

### üîç –ü–æ–¥—Å–∫–∞–∑–∫–∏

- **–ö—É—Ä—Å–æ—Ä/–≤–æ–¥—è–Ω–æ–π –∑–Ω–∞–∫**: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ —Ä–∞—Å—Ç—É—â–∏–π –∞—Ç—Ä–∏–±—É—Ç (`created_at` –∏–ª–∏ `id`). –•—Ä–∞–Ω–∏—Ç–µ –≤ —Ç–∞–±–ª–∏—Ü–µ `order_sync_cursor` –æ–¥–Ω—É —Å—Ç—Ä–æ–∫—É (–∏–ª–∏ –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ).
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: –ë–î-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ `UNIQUE(order_id)` –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π + –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ ¬´unique violation¬ª –∫–∞–∫ ¬´—É—Å–ø–µ—Ö/–ø–æ–≤—Ç–æ—Ä¬ª.
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –º–æ–∂–Ω–æ –Ω–∞–∑–Ω–∞—á–∞—Ç—å –∑–∞–∫–∞–∑—ã –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥–æ—Ä—É—Ç–∏–Ω —Å –≤–æ—Ä–∫–µ—Ä-–ø—É–ª–æ–º, **–Ω–µ –∑–∞–±—ã–≤–∞–π—Ç–µ –ø—Ä–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç** –∏ **–ª–∏–º–∏—Ç—ã**.
- **–†–µ—Ç—Ä–∞–∏**: —Ç–æ–ª—å–∫–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö (idempotent) GET/POST; –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `errors.Is`/HTTP-–∫–æ–¥—ã –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏—è.
- **–ì—Ä–µ–π—Å—Ñ—É–ª-—Å—Ç–æ–ø**: –ø–æ —Å–∏–≥–Ω–∞–ª—É `SIGTERM` –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ —Ç–∏–∫–µ—Ä –∏ –¥–æ–∂–∏–¥–∞–π—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π –ø–∞—á–∫–∏.

---

### üß™ –†–µ–∑—É–ª—å—Ç–∞—Ç

- ‚úÖ –ü–∞–∫–µ—Ç `internal/gateway/order` —Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π HTTP-–∫–ª–∏–µ–Ω—Ç–∞ –∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–æ–º `orders`.
- ‚úÖ –§–æ–Ω–æ–≤—ã–π –≤–æ—Ä–∫–µ—Ä `ordersync`, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–µ—Ä–≤–∏—Å–∞, –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç –∫–∞–∂–¥—ã–µ **5 —Å–µ–∫—É–Ω–¥** (–∏–ª–∏ –∏–∑ ENV).
- ‚úÖ –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —á–∞—Å—Ç–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç —Å –º–æ–∫-—Å–µ—Ä–≤–∏—Å–æ–º.

---

### ‚ñ∂Ô∏è –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ

1. –°–∫–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å `service-order`:
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å `service-order`, –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–µ—Ä–≤–∏—Å–∞ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
   ```bash
   make run
   ```
   –ó–∞–ø—É—Å—Ç–∏—Ç—å—Å—è —Å–∞–º —Å–µ—Ä–≤–∏—Å. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Ä–∞–±–æ—Ç—É –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏–≤ –∫–æ–º–∞–Ω–¥—É:
    ```
   curl --location --request POST 'http://localhost:8080/public/api/v1/debug/seed' --header 'Accept: application/json'
   ```
   –î–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å –¥–æ–±–∞–≤–∏—Ç –≤ —Å–µ—Ä–≤–∏—Å —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –î–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫–∏–µ –µ—Å—Ç—å –º–µ—Ç–æ–¥—ã –≤ —Å–µ—Ä–≤–∏—Å–µ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å postman –∏ —Å–¥–µ–ª–∞—Ç—å import —Ñ–∞–π–ª–∞ /service-order/api_openapi.yaml.
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–≤–æ–π —Å–µ—Ä–≤–∏—Å –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –ª–æ–≥–æ–≤ –æ —Ç–∏–∫–∞—Ö, –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è—Ö –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∫—É—Ä—Å–æ—Ä–∞ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —á–µ—Ä–µ–∑ –ë–î.
4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã:
   ```bash
   go test ./... -race
   ```

–£–¥–∞—á–∏! –≠—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –ø—Ä–∏–±–ª–∏–∂–∞–µ—Ç –≤–∞—à —Å–µ—Ä–≤–∏—Å –∫ ¬´–±–æ–µ–≤—ã–º¬ª —É—Å–ª–æ–≤–∏—è–º: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–º –¥–∞–Ω–Ω—ã—Ö.
