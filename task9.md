## üè† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∫—É—Ä—Å–∞ "–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –Ω–∞ GO"

### –ó–∞–¥–∞–Ω–∏–µ 9. –ú–µ—Ç—Ä–∏–∫–∏, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–í–∞—à –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è, –Ω–∞–∑–Ω–∞—á–∞–µ—Ç –∫—É—Ä—å–µ—Ä–æ–≤ ‚Äî –ø–æ—Ä–∞ –¥–æ–±–∞–≤–∏—Ç—å **–Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å (observability)**: –º–µ—Ç—Ä–∏–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å—Ä–µ–¥—ã.

> –í —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ –≤—ã –Ω–∞—É—á–∏—Ç–µ—Å—å —Å–æ–±–∏—Ä–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –ø–æ –≤—Å–µ–º HTTP-—Ä—É—á–∫–∞–º –∏ –≤–∏–∑—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ Prometheus –∏ Grafana.

---

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–ü–æ–¥–Ω—è—Ç—å `Prometheus` –∏ `Grafana` —á–µ—Ä–µ–∑ `docker-compose`**
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Prometheus –Ω–∞ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Å –≤–∞—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ (`/metrics`).
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Grafana –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Prometheus –∫–∞–∫ data source.
   - –°–æ–∑–¥–∞—Ç—å –¥–∞—à–±–æ—Ä–¥ —Å –±–∞–∑–æ–≤—ã–º–∏ –º–µ—Ç—Ä–∏–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä: –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤, –ø–æ –∫–æ–¥—É –æ—Ç–≤–µ—Ç–∞, –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç—É).

2. **–î–æ–±–∞–≤–∏—Ç—å `prometheus` middleware**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É [`promhttp`](https://pkg.go.dev/github.com/prometheus/client_golang/prometheus/promhttp) –∏–ª–∏ `go-chi/middleware`.
   - –°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π middleware, –∫–æ—Ç–æ—Ä—ã–π:
      - –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –≤—Ö–æ–¥—è—â–∏–µ HTTP-–∑–∞–ø—Ä–æ—Å—ã
        - `method` ‚Äî HTTP-–º–µ—Ç–æ–¥ –∑–∞–ø—Ä–æ—Å–∞ (`GET`, `POST`, `PUT`, `DELETE` –∏ —Ç.–¥.)
        - `path` ‚Äî –ø—É—Ç—å –∑–∞–ø—Ä–æ—Å–∞ (`/courier`, `/courier/assign`, –∏ —Ç.–¥.)
        - `status` ‚Äî –∫–æ–¥ –æ—Ç–≤–µ—Ç–∞ (`200`, `404`, `500` –∏ —Ç.–ø.)
        - `duration` ‚Äî —Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω—è–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (–≤ –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥–∞—Ö –∏–ª–∏ —Å–µ–∫—É–Ω–¥–∞—Ö)
      - —Å—á–∏—Ç–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ –≤—Å–µ–º api —ç–Ω–¥–ø–æ–π–Ω—Ç–∞–º;
      - –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `GET /metrics`, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–¥–∞—ë—Ç –º–µ—Ç—Ä–∏–∫–∏.

3. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –õ–æ–≥–∏—Ä—É–π—Ç–µ –∫–∞–∂–¥—ã–π HTTP-–∑–∞–ø—Ä–æ—Å —á–µ—Ä–µ–∑ middleware.
   - –§–æ—Ä–º–∞—Ç –ª–æ–≥–∞ –¥–æ–ª–∂–µ–Ω –≤–∫–ª—é—á–∞—Ç—å:
      - `timestamp` ‚Äî –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
      - `method`, `path`, `status`, `duration`
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—é–±—É—é —É–¥–æ–±–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (`log`, `zap`, `zerolog`, `slog` –∏ –¥—Ä.).
   - –ü—Ä–∏–º–µ—Ä —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞:
     ```
     [INFO] 2025/08/06 14:00:15 method=POST path=/courier/assign status=200 duration=43ms
     ```
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫–∏, –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–æ–≤ –∏ —Å–æ–±—ã—Ç–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∫—É—Ä—å–µ—Ä–∞.
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤ –∫–æ–¥–µ –Ω–µ—Ç –≤—ã–∑–æ–≤–æ–≤ fmt.Println, –µ—Å–ª–∏ –µ—Å—Ç—å –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
---

### üìé –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –º–µ—Ç—Ä–∏–∫

```go
var (
    httpRequestsTotal = prometheus.NewCounterVec(
        prometheus.CounterOpts{
            Name: "http_requests_total",
            Help: "Total number of HTTP requests",
        },
        []string{"method", "path", "status"},
    )

    httpRequestDuration = prometheus.NewHistogramVec(
        prometheus.HistogramOpts{
            Name:    "http_request_duration_seconds",
            Help:    "Duration of HTTP requests.",
            Buckets: prometheus.DefBuckets,
        },
        []string{"path"},
    )
)
```