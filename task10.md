## üè† –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∫—É—Ä—Å–∞ "–ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã –Ω–∞ GO"

### –ó–∞–¥–∞–Ω–∏–µ 10. Rate Limiter –∏ Retry –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –≤–Ω–µ—à–Ω–µ–º—É —Å–µ—Ä–≤–∏—Å—É

–ö–æ–≥–¥–∞ —Å–µ—Ä–≤–∏—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π –∏–ª–∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Å—Ç–æ—Ä–æ–Ω–Ω–∏–µ API ‚Äî –≤–∞–∂–Ω–æ —É–º–µ—Ç—å **–æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤ (rate limiting)**, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ–±—è –∏ –¥—Ä—É–≥–∏—Ö. –ê –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `429 Too Many Requests` ‚Äî **–ø–æ–≤—Ç–æ—Ä—è—Ç—å –∑–∞–ø—Ä–æ—Å (retry)**, –∞ –Ω–µ —Å—Ä–∞–∑—É –ø–∞–¥–∞—Ç—å —Å –æ—à–∏–±–∫–æ–π.

> –í —ç—Ç–æ–º –∑–∞–¥–∞–Ω–∏–∏ —Ç—ã –¥–æ–±–∞–≤–∏—à—å rate limiter –∫ —Å–≤–æ–µ–º—É —Å–µ—Ä–≤–∏—Å—É –∏ –Ω–∞—É—á–∏—à—å—Å—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –¥—Ä—É–≥–∏–º –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–º (`service-order`).

---

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å

1. **–î–æ–±–∞–≤–∏—Ç—å Rate Limiter –≤ `service-courier`**
    - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 RPS –Ω–∞ IP –∏–ª–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ).
    - –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (`golang.org/x/time/rate`, `github.com/ulule/limiter`, `github.com/didip/tollbooth`) –∏–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–≤–æ—é.
    - –ü–æ–¥–∫–ª—é—á–∏—Ç—å rate limiter –∫–∞–∫ middleware.
    - –ü—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `429 Too Many Requests`.

2. **–û–±–Ω–æ–≤–∏—Ç—å `service-order` gateway**
    - –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞ `429` (–∏–ª–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ—à–∏–±–æ–∫) –æ—Ç `service-courier` ‚Äî **–ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (retry)**.
    - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **—ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É** (backoff) –∏–ª–∏ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –ø–æ–ø—ã—Ç–∫–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 100‚Äì200 –º—Å).
    - –ú–∞–∫—Å–∏–º—É–º 3‚Äì5 –ø–æ–ø—ã—Ç–æ–∫.

3. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –º–µ—Ç—Ä–∏–∫–∏**
    - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∫–∞–∂–¥—ã–π —Å–ª—É—á–∞–π –ø—Ä–µ–≤—ã—à–µ–Ω–∏—è –ª–∏–º–∏—Ç–∞ (`rate limit exceeded`).
    - –î–æ–±–∞–≤–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ Prometheus:
        - `rate_limit_exceeded_total`
        - `gateway_retries_total`

4. **–û–±–Ω–æ–≤–∏—Ç—å —Ç–µ—Å—Ç—ã**
    - –ü–æ–∫—Ä—ã—Ç—å retry-–ª–æ–≥–∏–∫—É.
    - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞.
    - –ü—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏ ‚Äî –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é rate limiter'–∞.

---

### üîß –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ (RateLimiter middleware)

```go
limiter := rate.NewLimiter(5, 10) // 5 RPS, burst up to 10

func RateLimitMiddleware(next http.Handler) http.Handler {
    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
        if !limiter.Allow() {
            http.Error(w, "Too Many Requests", http.StatusTooManyRequests)
            return
        }
        next.ServeHTTP(w, r)
    })
}
